---------------------
--ESTRUTURA----------
---------------------

---------------------
--DELETE-------------
---------------------

DELETE FROM portal_sesmt.PRE_SOL_MV psm
--WHERE psm.CD_USUARIO_MV = UPPER('LDPGOMES')
--------------------------------------

---------------------
--INSERT-------------
---------------------

INSERT INTO portal_sesmt.PRE_SOL_MV

SELECT 
portal_sesmt.SEQ_CD_PRE_SOL_MV.NEXTVAL AS CD_PRE_SOL_MV,
'LDPGOMES'        AS CD_USUARIO_MV,
1                 AS CD_SOLICITACAO,
'HSSAMPAIO'       AS CD_USUARIO_CADASTRO,
SYSDATE           AS HR_CADASTRO,
NULL              AS CD_USUARIO_ULT_ALT,
SYSDATE           AS HR_ULT_ALT

FROM DUAL;


---------------------
--PROCEDURE----------
---------------------


--1 NEXTVAL SOL SAI PRO
--SELECT dbamv.SEQ_SOLSAI_PRO.NEXTVAL AS CD_SOLSAI_PRO FROM DUAL;

--2 ETL SOL SAI PRO

SELECT
123 AS CD_SOLSAI_PRO, --ok
'S' AS TP_SOLSAI_PRO, --ok
(SELECT st.CD_SETOR_MV AS CD_SETOR_MV 
 FROM portal_sesmt.SOLICITACAO st 
 WHERE st.CD_SOLICITACAO = psm.CD_SOLICITACAO) AS CD_SETOR,     
1 AS CD_ESTOQUE,      --ok
'P' AS TP_SITUACAO,   --ok
NULL AS CD_ATENDIMENTO,--ok
NULL AS CD_PRESTADOR, --ok
TO_DATE(TO_CHAR(SYSDATE,'DD/MM/YYYY'),'DD/MM/YYYY') AS DT_SOLSAI_PRO,--ok
NULL AS SN_EMITIDO, --ok
NULL AS CD_UNID_INT, --ok
TO_DATE(TO_CHAR(SYSDATE,'DD/MM/YYYY HH24:MI:SS'),'DD/MM/YYYY HH24:MI:SS') AS HR_SOLSAI_PRO,--ok
NULL AS CD_PRE_MED, --ok
NULL AS CD_ESTOQUE_SOLICITANTE, --ok
psm.CD_USUARIO_MV AS CD_USUARIO,--ok
NULL AS CD_SOLICITACAO_PRODUTO,--ok
'MAT ' || psm.CD_USUARIO_MV AS DS_OBS, --ok
NULL AS CD_TP_SOLICITACAO,--ok
NULL AS CD_MOT_DEV,--ok
NULL AS DT_IMPRESSAO, --ok
NULL AS CD_AGRUPAMENTO, --ok
NULL AS CD_OS, --ok
NULL AS CD_DEV_PRE, --ok
NULL AS CD_AVISO_CIRURGIA, --ok
TO_DATE(TO_CHAR(SYSDATE,'DD/MM/YYYY HH24:MI:SS'),'DD/MM/YYYY HH24:MI:SS') AS DT_GRAVACAO, --ok
NULL AS CD_TURNO, --ok
NULL AS DT_IMPRESSAO_AGRUP,--ok
NULL AS DT_CONSUMO_INICIAL, --ok
NULL AS DT_CONSUMO_FINAL, --ok
'N' AS SN_URGENTE, --ok
NULL AS CD_FECHAMENTO, --ok
NULL AS TP_ORIGEM_SOLICITACAO, --ok
NULL AS CD_SOLSAI_PRO_INTEGRA, --ok
NULL AS CD_SEQ_INTEGRA, --ok
NULL AS DT_INTEGRA, --ok
NULL AS CD_PACIENTE_INTEGRA, --ok
NULL AS NM_PACIENTE_INTEGRA, --ok
NULL AS CD_ENT_PRO, --ok
NULL AS CD_MUNICIPIO, --ok
NULL AS DS_MUNICIPIO, --ok
NULL AS CD_MUNICIPIO_INTEGRA,  --ok
NULL AS CD_CLINICA, --ok
NULL AS DS_CLINICA, --ok
NULL AS CD_CLINICA_INTEGRA, --ok
NULL AS CD_ATENDIMENTO_INTEGRA, --ok
NULL AS SN_CONTROLA_ATEND_DEVOL, --ok
NULL AS CD_REQUISICAO, --ok
NULL AS CD_MOTIVO_CANC, --ok
NULL AS DT_CANCELAMENTO, --ok
NULL AS DS_JUSTIFICATIVA_CANCELAMENTO, --ok
'N' AS SN_SOLIC_PADRAO, --ok
'S' AS SN_ATIVO_SOLIC_PADRAO, --ok
NULL AS DS_SOLIC_PADRAO,--ok
NULL AS CD_EMPRESA_DESTINO,--ok
NULL AS CD_MOVIMENTACAO_EST_RCBM_PARCI,--ok
NULL AS TP_STATUS_ROMANEIO,--ok
NULL AS CD_AVISO_CIRURGIA_PROD_ROUPA--ok
--SELECT * 
FROM portal_sesmt.PRE_SOL_MV psm
INNER JOIN dbasgu.USUARIOS usu
  ON usu.CD_USUARIO = psm.CD_USUARIO_MV
WHERE psm.CD_USUARIO_MV = 'LDPGOMES'
AND psm.CD_SOLICITACAO IN (SELECT MAX(aux.CD_SOLICITACAO) AS CD_SOLICITACAO
                           FROM portal_sesmt.PRE_SOL_MV aux
                           WHERE aux.CD_USUARIO_MV = 'LDPGOMES')


---------------------
--PROCEDURE----------
---------------------

--2 ETL SOL SAI PRO

SELECT 
--dbamv.SEQ_ITSOLSAI_PRO.NEXTVAL AS CD_ITSOLSAI_PRO --ok
12 AS CD_ITSOLSAI_PRO,
123 AS CD_SOLSAI_PRO,
sol.CD_PRODUTO_MV AS CD_PRODUTO, --ok
sol.CD_UNI_PRO AS CD_UNI_PRO, --ok
sol.QUANTIDADE AS QT_SOLICITADO,
NULL AS CD_TIP_PRESC, --ok
NULL AS CD_TIP_FRE, --ok
NULL AS SN_ATENDIDO, --ok
NULL AS CD_UNIDADE,--ok 
NULL AS CD_KIT_ESTOQUE,--ok
NULL AS CD_TIP_PRESC_KIT, --ok
NULL AS CD_LOTE,--ok
NULL AS DT_VALIDADE, --ok
NULL AS QT_PRESCRITA,--ok
NULL AS NR_DIAS, --ok
NULL AS TP_USO_PRODUTO, --ok
NULL AS CD_PRODUTO_KIT, --ok
NULL AS CD_FORMULA_KIT, --ok
NULL AS QT_KIT, --ok
NULL AS CD_MOT_DEV, --ok
'S'  AS SN_FATURA, --ok
NULL AS CD_ITPRE_MED, --ok
0 AS QT_ATENDIDA, --ok
NULL AS DS_NPADRONIZADO, --ok
NULL AS CD_ITDEV_PRE, --ok
NULL AS DS_OBS_ITPRE_MED, --ok
'N'  AS SN_CONF_DETERM_USU,
TO_DATE(TO_CHAR(SYSDATE,'DD/MM/YYYY HH24:MI:SS'),'DD/MM/YYYY HH24:MI:SS') AS DT_GRAVACAO, --ok
NULL AS DSP_CODIGO_DE_BARRAS, --ok
NULL AS DS_ALERTA_AUTOMATICO, --ok
NULL AS CD_ITSOLSAI_PRO_INTEGRA, --ok
NULL AS CD_SEQ_INTEGRA, --ok
NULL AS DT_INTEGRA, --ok
NULL AS CD_MOTIVO_DIVERG_ATEND, --ok
NULL AS SN_IMPRIME_ETQ_DOSE, --ok
NULL AS DT_ESTORNO_FFCV, --ok
NULL AS CD_ITENT_PRO, --ok
'N'  AS SN_COMPONENTE--ok
FROM portal_sesmt.PRE_SOL_MV psm
INNER JOIN portal_sesmt.SOLICITACAO sol
   ON sol.CD_SOLICITACAO = psm.CD_SOLICITACAO
WHERE psm.CD_USUARIO_MV = 'LDPGOMES'

